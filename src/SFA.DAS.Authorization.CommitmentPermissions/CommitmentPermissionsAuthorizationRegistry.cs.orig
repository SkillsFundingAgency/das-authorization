using SFA.DAS.Authorization.Cache;
using SFA.DAS.Authorization.CommitmentPermissions.Cache;
using StructureMap;

namespace SFA.DAS.Authorization.CommitmentPermissions
{
    public class CommitmentPermissionsAuthorizationRegistry : Registry
    {
        public CommitmentPermissionsAuthorizationRegistry()
        {
<<<<<<< HEAD
            For<IAuthorizationHandler>().Add<AuthorizationHandler>();
            For<ICommitmentsApiClient>().Use<CommitmentsApiClient>().Singleton();
=======
            For<IAuthorizationHandler>().Add<AuthorizationHandler>()
                .DecorateWith((ctx, handler) => BuildCache(ctx, handler))
                .Singleton();

            For<IAuthorizationHandlerCacheConfig>()
                .Add<AuthorizationContextCacheKeyProvider>()
                .Singleton();
        }

        private IAuthorizationHandler BuildCache(IContext ctx, IAuthorizationHandler handler)
        {
            var authCacheService = ctx.GetInstance<IAuthorizationCacheService>();
            return new AuthorizationHandlerCacheDecorator(authCacheService, handler);
>>>>>>> IoC registration
        }
    }
}